# 飞书多维表格数据表字段说明文档

本文档旨在详细阐述飞书多维数据表中各字段的定义、用途及其相互间的关联关系。文档结构以文件夹（二级标题）和数据表（三级标题）进行组织。请注意，每个数据表均以`id`作为首列，此为系统自动生成的唯一标识符，不可更改。后续表格将统一使用以下表头：`标题`（字段名称）、`类型`（字段数据类型）、`配置`（字段的具体设置或选项）、`说明`（字段含义及用途）。标记为“必填”的字段是菜品推荐算法的核心输入，必须确保数据完整；“非必填”或“选填”字段多用于飞书仪表盘的数据分析，虽非当前推荐系统必需，但未来可能纳入算法考量；“自动生成”字段的值由系统根据预设公式或数据关联自动计算得出。特别地，当字段类型为`公式`时，“说明”列将解释该公式的计算逻辑和业务含义，而非直接展示公式本身。为保证系统正常运行，所有字段的标题和属性（类型、配置）均不应修改。

---

🌻 若您对飞书文档的风格不甚满意，欢迎访问我们精心设计的GitBook文档页面，或许能为您提供更舒适的阅读体验：[https://mealoptima.gitbook.io/mealoptima/](https://mealoptima.gitbook.io/mealoptima/)

---

## 01-食堂管理

此部分用于管理各食堂运营所涉及的菜品及其使用的原料信息。

### 01-菜品管理

本数据表记录了食堂提供的所有菜品信息。

#### 菜品基础信息

| 标题           | 类型   | 配置                                   | 说明                                                                                                                               |
| -------------- | ------ | -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 菜品名称       | 文本   | 必填                                   | 菜品的标准名称。                                                                                                                   |
| 是否上架       | 单选   | 在售，下架。选项不可编辑，必填           | 标识菜品当前是否处于销售状态。“下架”状态的菜品将不参与推荐菜谱生成，且其销量和烹饪时间不计入间接成本的分摊计算。此设置便于管理历史菜品。     |
| 菜品类别       | 单选   | 引用`05-餐类配置`表`菜品类别`字段，必填 | 定义菜品的分类（如：主食、荤菜、素菜、汤类）。此分类将依据`05-餐类配置`中的数量要求，用于智能配餐。                                               |
| 适用餐时段     | 多选   | 引用`05-餐类配置`表`餐时段`字段，必填     | 指明菜品适合供应的餐次（如：早餐、午餐、晚餐）。此信息同样用于智能配餐，确保各餐次菜品符合`05-餐类配置`中的规定。                                     |
| 烹饪方法       | 单选   | 选项可编辑，非必填                       | 描述菜品的制作方式（如：炒、蒸、煮、炖、烤、炸等），主要用于后续的数据分析和仪表盘展示。                                                           |
| 健康等级       | 单选   | 选项不可编辑，非必填                       | 对菜品进行的健康评估分级（A/B/C/D），评估标准参见`附录`。此字段可由AI辅助生成，主要用于数据分析。                                                  |
| 预计日销量     | 数字   | 整数，必填                             | 预估该菜品每日的销售数量。此数值是计算`总间接成本-按销量分摊`的基础，仅“在售”菜品的此项数据参与计算。                                                 |
| 烹饪时间(小时) | 数字   | 整数，必填                             | 制作一份该菜品所需的平均时间（以小时计）。此数值是计算`总间接成本-按时间分摊`的基础，仅“在售”菜品的此项数据参与计算。                                         |

#### 菜品定价信息

| 标题                   | 类型   | 配置                             | 说明                                                                                                                                                                                                       |
| ---------------------- | ------ | -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 定价类型               | 单选   | 自动，手动。选项不可编辑，必填 | 定义菜品的最终定价方式。“自动”表示`最终定价`采用系统根据成本和利润率计算的`自动定价`；“手动”表示`最终定价`采用人工录入的`手动定价`。                                                                                 |
| 直接成本               | 公式   | 数字                             | 通过汇总`02-配料清单`表中与当前菜品关联的所有原料记录的`金额`计算得出，代表了制作该菜品所需原料的总成本。                                                                                                     |
| 总间接成本-按销量分摊 | 公式   | 数字                             | 计算公式为：(当前菜品的`预计日销量` * `04-间接成本`表中所有`分摊方式`为“销量”的成本项的`金额(每天)`之和) / `01-菜品管理`表中所有“在售”菜品的`预计日销量`总和。此项反映了基于销量分摊的间接成本部分。                               |
| 总间接成本-按时间分摊 | 公式   | 数字                             | 计算公式为：(当前菜品的`烹饪时间(小时)` * `04-间接成本`表中所有`分摊方式`为“时间”的成本项的`金额(每天)`之和) / `01-菜品管理`表中所有“在售”菜品的`烹饪时间(小时)`总和。此项反映了基于制作时间分摊的间接成本部分。                           |
| 总间接成本             | 公式   | 数字                             | 该菜品承担的全部间接成本，等于`总间接成本-按销量分摊`与`总间接成本-按时间分摊`之和。                                                                                                                     |
| 间接成本               | 公式   | 数字                             | 分摊到每份菜品上的间接成本，计算方式为`总间接成本`除以`预计日销量`。                                                                                                                                     |
| 总成本                 | 公式   | 数字                             | 制作并销售一份该菜品的总成本，等于`直接成本`与`间接成本`之和。                                                                                                                                             |
| 自动定价               | 公式   | 数字                             | 当`定价类型`为“自动”时，此价格根据`总成本`乘以 (1 + `07-系统配置`表中的`目标利润率(%)`) 计算得出。若`定价类型`非“自动”，则此字段值通常为-1或无意义。                                                                       |
| 手动定价               | 数字   | 选填                             | 人工设定的菜品价格。仅当`定价类型`为“手动”时，此价格才有效，并被`最终定价`字段引用。                                                                                                                             |
| 最终定价               | 公式   | 数字                             | 菜品的实际销售价格。如果`定价类型`为“自动”，则取`自动定价`的值；如果为“手动”，则取`手动定价`的值。                                                                                                               |

#### 菜品原料信息

| 标题           | 类型       | 配置         | 说明                                                                                                 |
| -------------- | ---------- | ------------ | ---------------------------------------------------------------------------------------------------- |
| 02-配料清单    | 双向关联   | 自动生成     | 自动关联至`02-配料清单`表，展示构成该菜品所需的所有原料及其详细信息（如用量、成本、营养成分等）。         |
| 配料信息       | 查找引用   | 文本，自动生成 | 从关联的`02-配料清单`记录中，查找并列出所有用于制作当前菜品的原料的`原料名称`。                               |

#### 菜品营养信息

| 标题           | 类型       | 配置             | 说明                                                                                                           |
| -------------- | ---------- | ---------------- | -------------------------------------------------------------------------------------------------------------- |
| 能量(Kcal)     | 查找引用   | 整数，自动生成     | 汇总当前菜品在`02-配料清单`中所有关联原料记录的`能量(Kcal)`值，得出该菜品的总能量。                                      |
| 蛋白质(g)      | 查找引用   | 小数，自动生成     | 汇总当前菜品在`02-配料清单`中所有关联原料记录的`蛋白质(g)`值，得出该菜品的总蛋白质含量。                                  |
| 脂肪(g)        | 查找引用   | 小数，自动生成     | 汇总当前菜品在`02-配料清单`中所有关联原料记录的`脂肪(g)`值，得出该菜品的总脂肪含量。                                      |
| 碳水化合物(g)  | 查找引用   | 小数，自动生成     | 汇总当前菜品在`02-配料清单`中所有关联原料记录的`碳水化合物(g)`值，得出该菜品的总碳水化合物含量。                              |

### 02-配料清单

本数据表作为`01-菜品管理`与`03-原料管理`之间的桥梁，详细记录了构成每一道菜品所需的各种原料及其用量信息。每条记录代表特定菜品与其对应的一种原料之间的关系。

| 标题          | 类型       | 配置                       | 说明                                                                                                                                 |
| ------------- | ---------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| 菜品ID        | 双向关联   | 必填，不允许添加多个记录   | 关联至`01-菜品管理`表，标识当前配料记录所属的菜品。                                                                                   |
| 菜品名称      | 查找引用   | 文本，自动生成             | 自动从`01-菜品管理`表中查找并引用与当前`菜品ID`对应的菜品`菜品名称`。                                                                   |
| 原料ID        | 双向关联   | 必填，不允许添加多个记录   | 关联至`03-原料管理`表，标识当前配料记录所使用的原料。                                                                                 |
| 原料名称      | 查找引用   | 文本，自动生成             | 自动从`03-原料管理`表中查找并引用与当前`原料ID`对应的原料`原料名称`。                                                                   |
| 净含量(g)     | 数字       | 必填                       | 指定在制作对应菜品时，该原料所需的净使用量（单位：克）。此数值是计算该原料`金额`及各项营养成分含量的基础。                               |
| 金额          | 公式       | 数字                       | 计算公式为：(`03-原料管理`表中对应原料的`单价(每kg)` * `净含量(g)`) / 1000。此字段反映了当前用量下该原料的成本。                           |
| 能量(Kcal)    | 公式       | 数字                       | 计算公式为：(`03-原料管理`表中对应原料的`能量(Kcal\|100g)` * `净含量(g)`) / 100。此字段反映了当前用量下该原料提供的能量值。                  |
| 蛋白质(g)     | 公式       | 数字                       | 计算公式为：(`03-原料管理`表中对应原料的`蛋白质(g\|100g)` * `净含量(g)`) / 100。此字段反映了当前用量下该原料提供的蛋白质含量。              |
| 脂肪(g)       | 公式       | 数字                       | 计算公式为：(`03-原料管理`表中对应原料的`脂肪(g\|100g)` * `净含量(g)`) / 100。此字段反映了当前用量下该原料提供的脂肪含量。                |
| 碳水化合物(g) | 公式       | 数字                       | 计算公式为：(`03-原料管理`表中对应原料的`碳水化合物(g\|100g)` * `净含量(g)`) / 100。此字段反映了当前用量下该原料提供的碳水化合物含量。 |

### 03-原料管理

本数据表集中管理食堂运营所需的所有原料基础信息，包括其营养成分、分类及成本等。

#### 原料库-视图

`原料库`视图包含了系统预置及用户自定义的全部原料数据。系统预置部分数据主要来源于“公共卫生科学数据中心”的[中国食物成分数据库](https://www.phsciencedata.cn/Share/ky_sjml.jsp?id=577e0301-ab65-432a-9bb7-a8342302e589)，并结合了[China Food Composition Data](https://github.com/Sanotsu/china-food-composition-data)项目的数据以及专业营养师的校对成果，形成了包含1698条记录的基础原料库。用户可以根据需要在此视图中添加自定义原料。详细的字段说明见下文`字段说明`部分。

#### 已用原料-视图

`已用原料`视图通过筛选`02-配料清单`字段不为空的记录，专门展示那些已被至少一个菜品实际使用的原料。这使得管理者可以方便地在此视图中集中维护常用原料的`单价(每kg)`等关键信息。

#### 字段说明

| 标题             | 类型     | 配置                                             | 说明                                                                                                                               |
| ---------------- | -------- | ------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| 原料名称         | 文本     | 必填                                             | 原料的标准名称。                                                                                                                   |
| 大类名称         | 单选     | 非必填，引用`90-原料分类`表`大类名称`字段       | 原料所属的主要分类（例如：`畜肉类及制品`、`蛋类及制品`、`蔬菜类及制品`等），引用自`90-原料分类`表。                                        |
| 子类名称         | 单选     | 非必填，引用`90-原料分类`表`子类名称`字段       | 原料所属的次级分类（例如：`猪肉`、`牛肉`、`羊肉`、`鸡肉`、`鸭肉`、`鸡蛋`等），引用自`90-原料分类`表。                                        |
| 来源类型         | 公式     | 自动生成                                         | 根据`原料ID`自动判断并标识原料来源。ID大于1698的视为“自定义”添加，其余为“系统”预置。                                                        |
| 单价(每kg)       | 货币     | 必填                                             | 该原料的市场采购单价，以“元/千克”为单位。是计算菜品`直接成本`的关键数据。                                                                  |
| 02-配料清单      | 双向关联 | 自动生成                                         | 自动关联至`02-配料清单`表，显示使用了该原料的所有菜品信息。                                                                              |
| 能量(Kcal\|100g)   | 数字     | 必填，整数                                       | 每100克该原料所含的能量值，单位为千卡（Kcal）。用于计算菜品的总能量。                                                                      |
| 蛋白质(g\|100g)  | 数字     | 必填，小数                                       | 每100克该原料所含的蛋白质质量，单位为克（g）。用于计算菜品的总蛋白质含量。                                                                |
| 脂肪(g\|100g)    | 数字     | 必填，小数                                       | 每100克该原料所含的脂肪质量，单位为克（g）。用于计算菜品的总脂肪含量。                                                                    |
| 碳水化合物(g\|100g)| 数字     | 必填，小数                                       | 每100克该原料所含的碳水化合物质量，单位为克（g）。用于计算菜品的总碳水化合物含量。                                                        |
| 其余营养信息     | 数字     | 非必填                                           | 包含除宏量营养素外的其他营养成分信息（如维生素、矿物质等）。当前版本的菜品推荐算法暂未使用这些数据，但可供未来扩展或数据分析使用。 |

## 04-通用设置

`04-通用设置`文件夹包含用于成本核算和菜品推荐算法的关键配置信息。

### 04-间接成本

本数据表用于记录和管理食堂运营中产生的各项间接成本。数据可按`类型`进行分组查看。

| 标题           | 类型   | 配置             | 说明                                                                                                                                                                                                       |
| -------------- | ------ | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 间接成本名称   | 文本   | 必填             | 具体的间接成本项目名称，例如：`水电费`、`人工费`、`房租费`等。                                                                                                                                               |
| 类型           | 单选   | 非必填，选项可编辑 | 间接成本的分类，便于归类统计，例如：`人工成本`、`餐具及清洁用品成本`、`设备折旧成本`、`能源成本`、`其他杂项成本`。                                                                                             |
| 分摊方式       | 单选   | 销量、时间，必填 | 定义该项间接成本如何分摊至菜品。选项包括“销量”和“时间”。系统在`01-菜品管理`表中计算`总间接成本-按销量分摊`和`总间接成本-按时间分摊`时，将依据此处设置的`分摊方式`，分别汇总对应类型的间接成本进行计算。 |
| 金额(每月)     | 货币   | 必填             | 该项间接成本的月度总金额，单位为元/月。                                                                                                                                                                 |
| 金额(每天)     | 公式   | 自动生成         | 根据`金额(每月)`和`07-系统配置`表中的`每月营业日数`自动计算得出的每日间接成本金额。计算逻辑为：`金额(每月)` 除以 `07-系统配置`表中`配置名称`为“每月营业日数”的记录所对应的`值`。                               |

### 05-餐类配置

`05-餐类配置`数据表定义了不同餐时段（早餐、午餐、晚餐）应包含的各类菜品的标准数量。数据按`餐时段`分组，并按`餐类配置ID`升序排列。通常，用户仅需根据实际运营需求修改`数量`字段。

**重要说明：**

* 若某一餐时段下所有菜品类别的`数量`均设为0，则菜品推荐算法将认为该餐时段不供餐。在计算每日营养需求时，会自动排除该餐时段，仅基于实际供餐时段（如午餐+晚餐）的营养标准进行计算。
* 若食堂不提供某个`菜品类别`（如汤类），将其对应的`数量`设置为0即可。
* `餐时段`字段为固定选项，不可修改。
* `菜品类别`字段允许用户新增自定义类别，但系统预设的核心类别（如主食、荤菜、素菜、汤等）不可修改或删除。

| 标题     | 类型   | 配置                                           | 说明                                                                                                                             |
| -------- | ------ | ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| 餐时段   | 单选   | 必填，选项不可编辑                               | 标识该配置适用的餐次，固定选项包括`早餐`、`午餐`、`晚餐`。                                                                              |
| 菜品类别 | 单选   | 必填，选项可以新增，但默认的选项内容不可修改或删除 | 定义菜品的分类，如`主食`、`荤菜`、`素菜`、`汤`等。此字段用于智能配餐，确保生成的推荐菜谱中各类菜品的数量符合本表设定的`数量`要求。 |
| 数量     | 数字   | 必填，整数                                     | 指定在对应`餐时段`，该`菜品类别`应提供的标准菜品数量。                                                                               |

### 06-营养标准-每餐

`06-营养标准-每餐`数据表设定了各个餐时段（`早餐`、`午餐`、`晚餐`）的宏量营养素参考摄入量。当前版本仅支持对`能量(Kcal)`、`蛋白质(g)`、`脂肪(g)`、`碳水化合物(g)`进行标准设定。本表的默认值参考了通用营养指南（详见`附件`中的`营养标准`），若无特殊膳食需求或专业指导，不建议用户自行修改。

| 标题       | 类型   | 配置             | 说明                                                                 |
| ---------- | ------ | ---------------- | -------------------------------------------------------------------- |
| 餐时段     | 单选   | 必填，选项不可编辑 | 标识该营养标准适用的餐次，固定选项包括`早餐`、`午餐`、`晚餐`。                 |
| 营养素名称 | 单选   | 必填，选项不可编辑 | 具体的宏量营养素名称，固定选项包括`能量(Kcal)`、`蛋白质(g)`、`脂肪(g)`、`碳水化合物(g)`。 |
| 标准值     | 数字   | 必填，小数       | 该`营养素名称`在对应`餐时段`的推荐摄入量，单位依据营养素名称确定（`Kcal`或`g`）。 |

### 07-系统配置

`07-系统配置`数据表中，记录了成本核算和菜品推荐算法中用到的配置信息。除非算法有更新，否则不推荐新增配置项。但是可以根据需要修改各个配置的`值`。

字段说明如下：

| 标题       | 类型   | 配置                             | 说明                                                                                             |
| ---------- | ------ | -------------------------------- | ------------------------------------------------------------------------------------------------ |
| 配置名称   | 文本   | 必填                             | 配置项的唯一标识名称，例如：`目标利润率(%)`、`营养素偏差比例`等。                                       |
| 配置类型   | 单选   | 可编辑、不可编辑，非必填，选项不可编辑 | 标识该配置项的值是否允许用户修改。“可编辑”项的值可以调整，“不可编辑”项通常由系统维护或不应轻易更改。 |
| 配置描述   | 文本   | 非必填                           | 对配置项功能的详细文字说明。                                                                       |
| 值         | 数字   | 必填                             | 配置项的当前设定值。当`配置类型`为“可编辑”时，用户可修改此值。成本核算和菜品推荐算法将基于此值进行计算。 |
| 推荐值     | 数字   | 非必填                           | 提供一个建议的或默认的配置值，供用户参考。                                                         |

#### 成本核算配置项说明

| 配置名称       | 类型 | 配置         | 说明                                                                                                                               |
| -------------- | ---- | ------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| 目标利润率(%) | 数字 | 必填         | 期望达到的利润百分比。此值用于`01-菜品管理`表中计算`自动定价`，其计算逻辑为：`总成本` * (1 + `目标利润率(%)` / 100)。                       |
| 每月营业日数 | 数字 | 必填，整数   | 食堂每月实际运营的天数。此值用于`04-间接成本`表中计算`金额(每天)`，其计算逻辑为：`金额(每月)` / `每月营业日数`。                               |

#### 菜品推荐配置项说明

| 配置名称             | 类型 | 配置                             | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| -------------------- | ---- | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 菜品最小重复天数     | 数字 | 必填，整数                       | 控制同一菜品在连续排餐计划中再次出现的最小间隔天数。例如，若设为3，则某菜品在第0天出现后，最早只能在第3天再次被推荐。若当前菜品数量不足以满足最小重复天数的需求，则返回错误信息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 营养权重             | 数字 | 必填，取值范围0-1，小数           | 用于平衡营养得分和价格得分在最终推荐排序中的重要性。计算综合得分时，营养得分的权重为此`值`，价格得分的权重为 (1 - `值`)。公式为：`营养权重 * 营养得分 + (1 - 营养权重) * 价格得分`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 每日餐标(元)         | 数字 | 必填                             | 每日配餐的预算标准，单位为元。算法将尝试使每日推荐菜品的总价接近此标准。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 配餐天数             | 数字 | 必填，整数                       | 需要生成的连续排餐方案的总天数，例如输入`7`表示生成未来一周的菜单。最大值通常限制为30天。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 餐标浮动比例         | 数字 | 必填，取值范围0-1，小数           | 允许每日实际配餐总价与`每日餐标(元)`之间波动的百分比范围。例如，0.1表示允许总价在标准餐标的±10%内浮动。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 营养素偏差比例       | 数字 | 必填，取值范围0-1，小数           | 允许每日实际摄入的各种宏量营养素（能量、蛋白质、脂肪、碳水化合物）与对应营养标准之间波动的百分比范围。例如，0.2表示允许各营养素摄入量在标准值的±20%内浮动。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 整体权重调整策略     | 数字 | 0（线性）、1（指数），必填         | 定义在多日配餐过程中，如何动态调整“当日表现”（营养、价格）与“整体累计表现”在综合评分中的权重。策略0（线性）：随着配餐天数（`day`）的增加，整体表现的权重 (`total_weight`) 线性增长，但受`整体权重上限`限制；策略1（指数）：整体表现的权重随天数指数增长，逐渐趋近于`整体权重上限`，早期更侧重当日表现。此策略下`整体权重上限`仅作为指数增长的目标值。                                                                                                                                                                                                                                                                                                                                                                                            |
| 整体权重上限         | 数字 | 必填，取值范围0-1，小数           | 当`整体权重调整策略`为0（线性）时，此值设定了“整体累计表现”（`nutri_score_total`, `price_score_total`）在综合评分中所能占到的最大权重比例。随着配餐天数 (`day`) 推进，整体权重 (`total_weight`) 会增加，计算方式为 `min(day / 配餐天数, 整体权重上限)`（线性策略）或 `整体权重上限 * (1 - exp(-day / 配餐天数))`（指数策略）。最终的营养分和价格分计算如下：`营养分 = (1 - total_weight) * (当日餐次营养分 * 0.5 + 当日全天营养分 * 0.5) + total_weight * 整体营养分`；`价格分 = (1 - total_weight) * 当日价格分 + total_weight * 整体价格分`。默认值0.4意味着整体考量最多占40%。 |
| 多样性权重           | 数字 | 必填，取值范围0-1，小数           | 控制菜品多样性在推荐算法中的重要程度。值越高，系统越倾向于推荐更多不同种类的菜品（主食除外，因其种类有限常需重复）。多样性得分会按此权重计入最终综合评分。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| top_k                | 数字 | 必填，整数，>=1                  | 在计算出所有候选菜品的综合得分后，系统将从得分排名前`k`的菜品中进行随机选择。若设为1，则表示直接选择得分最高的菜品，关闭随机性。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| temperature          | 数字 | 必填，取值范围0.1-1.0，小数      | 在`top_k` > 1 时，控制随机选择的倾向性。`temperature`值越小（接近0.1），选择越集中于得分更高的菜品；值越大（接近1.0），选择越分散，得分较低的候选菜品也有更大机会被选中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

## 08-排餐方案

使用飞书`菜品生成`自动化流程生成的排餐方案会自动保存在`08-排餐方案`文件夹中。此文件夹下的所有记录均由自动化流程生成，请勿手动修改。每个数据表都包含一个`创建时间`字段（例如：`2025-04-06 21:00`），用于记录各配餐方案的生成时刻。

### 08-排餐方案-总体

`08-排餐方案-总体`数据表记录了每次执行`菜品生成`流程后产生的完整排餐方案的概要信息。自动化流程会为指定的配餐天数在`09-排餐方案-每天`和`10-排餐方案-每餐`表中创建详细记录，并将本次配餐的总体情况汇总于此。本表默认按`创建时间`降序排列，以便最新生成的配餐方案显示在最前方。

| 标题                         | 类型     | 配置     | 说明                                                                                                                                                                                                                            |
| ---------------------------- | -------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 警告信息                     | 文本     | 自动生成 | 列出在生成的配餐方案中，每日价格或营养素摄入量超出预设允许偏差范围（`餐标浮动比例`或`营养素偏差比例`）的情况。每条警告会指明具体天数、超标指标（如价格、能量）、超标方向（`[+]`表示高于上限，`[-]`表示低于下限）、允许偏差范围、当前值和标准值。详见下方示例。 |
| 平均每日价格(当前值/标准值)    | 文本     | 自动生成 | 展示整个配餐方案期间的平均每日餐费与设定的`每日餐标(元)`对比结果。使用符号（✅/❌）标示平均价格是否落在`餐标浮动比例`允许的浮动范围内，并显示 `实际平均值/目标标准值 [±允许浮动比例]`。详见下方示例。                                               |
| 平均每日营养(当前值/标准值)    | 文本     | 自动生成 | 以JSON格式汇总展示整个配餐方案期间各项宏量营养素的平均每日摄入量与`95-营养标准-每日`中对应标准值的对比。对每项营养素，使用符号（✅/❌）标示平均摄入量是否落在`营养素偏差比例`允许的浮动范围内，并显示 `"营养素名称": "符号 实际平均值/标准值 [±允许偏差比例]"`。详见下方示例。 |
| 09-排餐方案-每天             | 双向关联 | 自动生成 | 关联至`09-排餐方案-每天`数据表，允许查看本次生成的配餐方案中每一天的详细排餐情况与统计数据。                                                                                                                                   |
| 10-排餐方案-每餐             | 双向关联 | 自动生成 | 关联至`10-排餐方案-每餐`数据表，允许查看本次生成的配餐方案中每一天每一餐的具体菜品安排。                                                                                                                                       |
| 系统配置                     | 文本     | 自动生成 | 存储生成此配餐方案时所使用的`07-系统配置`数据表内容的文本快照，用于记录和追溯生成该方案的具体参数设置。                                                                                                                            |
| 餐类配置                     | 文本     | 自动生成 | 存储生成此配餐方案时所使用的`05-餐类配置`数据表内容的文本快照，记录了生成该方案时各餐时段的菜品类别数量要求。                                                                                                                        |
| 每日营养标准                 | 文本     | 自动生成 | 存储生成此配餐方案时所依据的每日宏量营养素标准（来源于`95-营养标准-每日`）的文本快照。                                                                                                                                             |
| 每餐营养标准                 | 文本     | 自动生成 | 存储生成此配餐方案时所依据的每餐宏量营养素标准（来源于`06-营养标准-每餐`）的文本快照。                                                                                                                                             |

#### 警告信息-示例

```
警告 [-]：Day 1 能量(Kcal) 不在允许范围内 [±40.0%] （当前值/标准值：699.6/1400.0）
警告 [-]：Day 1 碳水化合物(g) 不在允许范围内 [±50.0%] （当前值/标准值：12.4/190.0）
警告 [+]：Day 1 价格 不在允许范围内 [±10.0%] （当前值/标准值：383.2/30.0）
警告 [-]：Day 2 能量(Kcal) 不在允许范围内 [±40.0%] （当前值/标准值：699.6/1400.0）
警告 [-]：Day 2 碳水化合物(g) 不在允许范围内 [±50.0%] （当前值/标准值：12.4/190.0）
警告 [+]：Day 2 价格 不在允许范围内 [±10.0%] （当前值/标准值：383.2/30.0）
```

#### 平均每日价格-示例

```
❌ 383.2/30.0 [±10.0%]
```

#### 平均每日营养-示例

```json
{
    "能量(Kcal)": "❌ 699.6/1400.0 [±40.0%]",
    "蛋白质(g)": "✅ 47.8/46.0 [±50.0%]",
    "脂肪(g)": "✅ 51.8/40.0 [±50.0%]",
    "碳水化合物(g)": "❌ 12.4/190.0 [±50.0%]"
}
```

### 09-排餐方案-每天

`09-排餐方案-每天`数据表详细记录了每次生成的配餐方案中每一天的具体情况，包括价格和营养统计。本表默认按`创建时间`和关联的`08-排餐方案-总体`记录进行分组，并按`创建时间`降序排列；在每个方案的分组内部，则按`天数`升序排列。这种排序方式确保最新的配餐方案优先显示，且方案内的每一天按自然顺序排列。

| 标题                   | 类型     | 配置     | 说明                                                                                                                                                                                                                           |
| ---------------------- | -------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 08-排餐方案-总体       | 双向关联 | 自动生成 | 关联回`08-排餐方案-总体`数据表，指明此条每日记录所属的完整配餐方案。                                                                                                                                                             |
| 天数                   | 数字     | 自动生成 | 表示此记录是对应配餐方案中的第几天，从1开始计数。                                                                                                                                                                               |
| 价格(当前值/标准值)    | 文本     | 自动生成 | 显示当日所有餐次的总价与设定的`每日餐标(元)`的对比结果。使用符号（✅/❌）标示当日总价是否落在`餐标浮动比例`允许的范围内，并显示 `当日实际总价/目标标准值 [±允许浮动比例]`。详见下方示例。                                              |
| 营养(当前值/标准值)    | 文本     | 自动生成 | 以JSON格式汇总展示当日所有餐次摄入的各项宏量营养素总量与`95-营养标准-每日`中对应标准值的对比。对每项营养素，使用符号（✅/❌）标示当日摄入量是否落在`营养素偏差比例`允许的范围内，并显示 `"营养素名称": "符号 当日实际摄入量/标准值 [±允许偏差比例]"`。详见下方示例。 |
| 10-排餐方案-每餐       | 双向关联 | 自动生成 | 关联至`10-排餐方案-每餐`数据表，允许查看当日各餐次的具体菜品安排。                                                                                                                                                             |

#### 当日价格-示例

```
❌ 383.2/30.0 [±10.0%]
```

#### 当日营养-示例

```json
{
    "能量(Kcal)": "❌ 699.6/1400.0 [±40.0%]",
    "蛋白质(g)": "✅ 47.8/46.0 [±50.0%]",
    "脂肪(g)": "✅ 51.8/40.0 [±50.0%]",
    "碳水化合物(g)": "❌ 12.4/190.0 [±50.0%]"
}
```

### 10-排餐方案-每餐

`10-排餐方案-每餐`数据表记录了配餐方案中最细粒度的信息：每一天每一餐的具体菜品安排。本表默认按`创建时间`以及关联的`08-排餐方案-总体`和`09-排餐方案-每天`记录进行分组，并按`创建时间`降序排列；在每个方案的每日分组内部，则按`餐时段`的预设顺序（早餐、午餐、晚餐）和`菜品类别`的升序排列（如：主食、荤菜、素菜、汤）。这样可以清晰地查看最新方案，并按天、按餐次、按类别顺序浏览菜品。

| 标题             | 类型       | 配置     | 说明                                                                                                                               |
| ---------------- | ---------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 08-排餐方案-总体 | 双向关联   | 自动生成 | 关联回`08-排餐方案-总体`数据表，指明此条每餐记录所属的完整配餐方案。                                                                     |
| 09-排餐方案-每天 | 双向关联   | 自动生成 | 关联回`09-排餐方案-每天`数据表，指明此条每餐记录所属的具体日期。                                                                        |
| 天数             | 查找引用   | 自动生成 | 从关联的`09-排餐方案-每天`记录中查找并引用对应的`天数`值。                                                                                  |
| 餐时段           | 单选       | 自动生成 | 标识该条记录对应的餐次，选项固定为`早餐`、`午餐`、`晚餐`。                                                                                  |
| 菜品ID           | 单向关联   | 自动生成 | 关联至`01-菜品管理`数据表，指定本餐次推荐的具体菜品。                                                                                    |
| 菜品类别         | 查找引用   | 自动生成 | 从关联的`菜品ID`在`01-菜品管理`表中的记录查找并引用其`菜品类别`。                                                                          |
| 菜品名称         | 查找引用   | 自动生成 | 从关联的`菜品ID`在`01-菜品管理`表中的记录查找并引用其`菜品名称`。                                                                          |
| 菜品当前定价     | 货币       | 自动生成 | 记录在生成此配餐方案时，所选`菜品ID`在当时的`最终定价`。这是一个固定值快照，不会随`01-菜品管理`表中菜品价格的后续变动而自动更新。 |

### 11-排餐方案-生成日志

飞书`菜品生成`自动化流程执行完毕后，其运行日志的关键信息会保存到`11-排餐方案-生成日志`数据表中。用户应检查`回调信息`和`Coze工作流返回结果`字段的内容以确认配餐方案是否成功生成。成功后，可前往`08-排餐方案-总体`数据表查看生成的方案详情。本表默认按`创建时间`降序排序，方便查看最近的执行日志。

| 标题                 | 类型 | 配置     | 说明                                                                                                   |
| -------------------- | ---- | -------- | ------------------------------------------------------------------------------------------------------ |
| 回调信息             | 文本 | 自动生成 | 记录飞书自动化流程（例如`菜品生成`流程）执行过程中的状态或日志信息。                                                |
| Coze工作流返回结果   | 文本 | 自动生成 | 记录外部Coze工作流（或其他类似服务）在被自动化流程调用后返回的完整结果，通常包含执行状态码、消息和数据等。 |

#### 正确返回示例

```
回调信息：

操作已执行，请查看 Coze 工作流返回信息

Coze工作流返回结果：

{"code":0,"cost":"0","data":"{\"output\":\"配餐计划生成成功\"}","debug_url":"https://www.coze.cn/work_flow?execute_id=7489443776277364770&space_id=7468151605272690707&workflow_id=7487502311633616923&execute_mode=2","msg":"Success","token":0}
```

## 90-引用选项

`90-引用选项`文件夹用于存储数据表中单选或多选字段所需引用的选项列表。

### 90-原料分类

`90-原料分类`数据表定义了原料的层级分类体系，包括大类和子类。在`03-原料管理`数据表中，`大类名称`和`子类名称`字段通过引用本表的相应字段来实现标准化分类。为确保数据一致性，不建议修改本表内容。

字段说明如下：

| 标题     | 类型 | 配置 | 说明             |
| -------- | ---- | ---- | ---------------- |
| 大类名称 | 单选 |      | 原料所属的主要类别。 |
| 子类名称 | 单选 |      | 原料所属的次级类别。 |

## 95-其他参数

`95-其他参数`文件夹包含了定价和推荐算法可能引用的其他参数表。

### 95-营养标准-每日

`95-营养标准-每日`数据表汇总了每日应达到的宏量营养素摄入总量标准。其数值是基于`06-营养标准-每餐`数据表中各餐时段的`标准值`，按`营养素名称`进行加总计算得出。此表为自动计算生成，用户不可直接修改。

字段说明如下：

| 标题       | 类型     | 配置     | 说明                                                                                      |
| ---------- | -------- | -------- | ----------------------------------------------------------------------------------------- |
| 营养素名称 | 文本     |          | 宏量营养素的名称，当前包括`能量(Kcal)`、`蛋白质(g)`、`脂肪(g)`、`碳水化合物(g)`。               |
| 标准值     | 查找引用 | 自动生成 | 从`06-营养标准-每餐`数据表中，查找并汇总所有餐时段对应营养素的`标准值`，得到每日的总推荐摄入量。 |

## 99-智能菜单生成（仪表盘）

`99-智能菜单生成`是一个配置在飞书仪表盘上的交互组件。它包含一个名为`智能菜单生成`的按钮，该按钮与预设的飞书`菜品生成`自动化工作流相关联。点击此按钮将触发自动化流程，启动智能配餐算法。用户可以在飞书自动化中心找到对应的`菜品生成`流程，并在其`运行日志`选项卡中查看详细的执行记录和结果。

## 100-数据分析

`100-数据分析`文件夹旨在存放用于数据分析和可视化的相关仪表盘。

### 100-仪表盘

此部分计划用于集成数据分析和可视化功能。目前，飞书仪表盘的具体实现尚未完成，但可以参考先前使用 Tableau 完成的`某校多档口食堂就餐行为可视化分析报告`。该报告基于某校食堂的消费数据，构建了一个可视化分析体系，旨在为管理者提供决策支持，并揭示学生群体的饮食习惯特征。报告通过对消费时间、档口收入、菜品健康等级等多维度数据进行处理与建模，并结合大语言模型对菜品进行健康分级（A/B/C/D），深入分析了师生餐饮消费行为。主要发现包括：学生就餐率显著高于教师；师生用餐高峰时段存在差异；学生对某些不健康食品依赖度较高等。报告还指出了热门档口在健康食品供应方面存在的问题，并通过交互式仪表盘直观展示了关键指标，为优化供餐结构、引导健康饮食提供了数据支撑。

**参考资料:**

* **Tableau 可交互工作簿:** [https://public.tableau.com/views/Canteen-Data-Viz-Book/Dashboard1](https://public.tableau.com/views/Canteen-Data-Viz-Book/Dashboard1?:language=en-US&:sid=&:redirect=auth&:display_count=n&:origin=viz_share_link)
* **原始数据下载 (示例):** [pan.baidu.com](https://pan.baidu.com/s/1BQaqTrM7Uz_RlldsRJLcpg?pwd=6jhr)
